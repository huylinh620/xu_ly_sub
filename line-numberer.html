<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Ứng dụng Đánh số dòng</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f6fa;
      color: #2c3e50;
      padding: 20px;
    }
    h1 { font-size: 22px; }
    textarea {
      width: 100%; 
      height: 200px; 
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
      padding: 10px;
    }
    button, input[type="file"] {
      margin: 5px 5px 5px 0;
      padding: 8px 14px;
      cursor: pointer;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      background: #3498db;
      color: white;
    }
    button:hover { background: #2980b9; }
    #output {
      background: #fff;
      padding: 10px;
      border: 1px solid #ccc;
      min-height: 200px;
      white-space: pre-wrap;
      font-family: monospace;
    }
    button:disabled, button:disabled:hover {
      background: #bdc3c7;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h1>Ứng dụng Đánh số dòng (JS)</h1>
  
  <input type="file" id="fileInput" accept=".txt"><br>
  
  <p>Nhập hoặc tải file TXT vào đây:</p>
  <textarea id="inputText"></textarea><br>
  
  <button onclick="addLineNumbers()">➕ Đánh số dòng</button>
  <button onclick="removeLineNumbers()">➖ Bỏ số dòng</button>
  <button onclick="downloadTxt()" class="export-btn">⬇️ Xuất file TXT</button>
  
  <h3>Kết quả:</h3>
  <textarea id="output"></textarea>

  <script>
    const exportBtn = document.querySelector(".export-btn");
    exportBtn.disabled = true;
    // Upload file txt
    let fileName = 'default.txt';
    document.getElementById("fileInput").addEventListener("change", function(event) {
      document.getElementById("inputText").value = "";
      const file = event.target.files[0];
      fileName = file.name;

      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          document.getElementById("inputText").value = e.target.result;
        };
        reader.readAsText(file);
      }
    });

    function addLineNumbers() {
      exportBtn.disabled = false;
      const input = document.getElementById("inputText").value.split("\n")
                    .map(line => line.trim())       // bỏ khoảng trắng dư
                    .filter(line => line.length>0); // bỏ dòng trống
      const numbered = input.map((line, i) => `Line ${i+1}\n${line}`).join("\n\n");
      document.getElementById("output").textContent = numbered;
    }

    function removeLineNumbers() {
      exportBtn.disabled = false;
      const input = document.getElementById("inputText").value.split("\n")
        .map(line => line.trim())
        .filter(line => line.length>0 && !line.startsWith("Line ")); // bỏ trống + bỏ "Line n"
      document.getElementById("output").value = input.join("\n\n");
    }

    function downloadTxt() {
      const text = document.getElementById("output").value;
      const blob = new Blob([text], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = fileName.replace(/\.txt$/i, '') + "_output.txt";
      link.click();
    }
  </script>
</body>
</html>
